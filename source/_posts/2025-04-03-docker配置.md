---
title: docker部署中间件
date: 2025-04-03 00:00:00
tags:
  - docker
---

在wsl里面

# mysql


```
mkdir -p data/mysql8/{conf,data}
touch mysql8/conf/my.cnf
chown -R 999:999 mysql8
```
在my.cnf写入以下信息
```
[mysqld]
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /var/lib/mysql
secure-file-priv= /var/lib/mysql
```

```
docker pull mysql:8.0
docker run -d \
    -p 3306:3306 \
    --name mysql \
    -v /data/mysql/conf/my.cnf:/etc/mysql/my.cnf \
    -v /data/mysql/data:/var/lib/mysql \
    -e MYSQL_ROOT_PASSWORD=123456 \
    mysql:8.0
    
# 进入mysql
docker exec -it mysql bash
mysql -u root -p
```

## mysql5.7


```
mkdir -p /data/mysql5/{conf,data}
touch mysql5/conf/my.cnf
chown -R 999:999 mysql5
```

在my.cnf写入以下信息
```
[mysqld]
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /var/lib/mysql
secure-file-priv= /var/lib/mysql
```


```
docker pull mysql:5.7
docker run -d \
    -p 3306:3306 \
    --name mysql5 \
    -v /data/mysql5/conf/my.cnf:/etc/mysql/my.cnf \
    -v /data/mysql5/data:/var/lib/mysql \
    -e MYSQL_ROOT_PASSWORD=123456 \
    mysql:5.7
# 进入mysql
docker exec -it mysql bash
mysql -u root -p
```

# redis

准备配置文件
```bash
touch /data/redis/conf/redis.conf
```
[Redis configuration | Docs](https://redis.io/docs/latest/operate/oss_and_stack/management/config/) 去官网找配置文件，直接配置文件中

以下是常见配置，直接在官方配置文件搜索，修改即可
```
# 实现数据持久化
appendonly yes

#注释下下面这
# bind 127.0.0.1 -::1

requirepass [密码]

```

```
docker pull redis

docker run \
-p 6379:6379 \
--name redis \
-v /data/redis/conf/redis.conf:/etc/redis/redis.conf \
-v /data/redis/data:/data \
-d \
redis:latest redis-server /etc/redis/redis.conf


#测试redis服务
docker exec -it redis redis-cli
```

# Rabbitmq
```
mkdir -p /data/rabbitmq/plugins

docker pull rabbitmq:4.0.7-management

docker run -d \
 --name mq \
 --hostname mq \
 -p 15672:15672 \
 -p 5672:5672 \
 -v mq-plugins:/opt/rabbitmq/plugins \
rabbitmq:4.0.7-management
```

然后可以在localhost:15672里面进入web端管理，默认密码和账号都是guest

插件挂载到docker的数据卷。如果挂载本地目录，那么mq的系统插件就不能加载到

# 单节点ElasticSearch



```bash
docker pull docker.elastic.co/elasticsearch/elasticsearch:8.10.0
```



```
docker run -d \
  --name es8 \
  -p 9200:9200 \
  -p 9300:9300 \
  -e "discovery.type=single-node" \
  -e "xpack.security.enabled=false" \
  -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
  docker.elastic.co/elasticsearch/elasticsearch:8.10.0
```

参数说明：

- `--name es8`：指定容器名称
- `-p 9200:9200`：映射 HTTP 端口
- `-p 9300:9300`：映射节点间通信端口
- `discovery.type=single-node`：单节点模式
- `xpack.security.enabled=false`：禁用安全验证（简化测试环境）
- `ES_JAVA_OPTS`：设置 JVM 内存大小



然后使用docker ps看有没有启动容器，然后使用以下命令查询es是否正常运行

```bash
curl http://localhost:9200
```



## 安装IK分词器



[IK分词器github仓库](https://github.com/infinilabs/analysis-ik?tab=readme-ov-file)



```bash
# 进入容器内部
docker exec -it es8 /bin/bash

# 安装IK分词器
bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.10.0

# 退出容器
exit

# 重启Elasticsearch使插件生效
docker restart es8

# 查看插件列表，会出现ik分词器的。 两个都可以
docker exec -it es8 ./bin/elasticsearch-plugin list
curl -X GET "http://localhost:9200/_cat/plugins?v"     

```